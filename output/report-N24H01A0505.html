<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Proficiency Report - N24H01A0505</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; text-align: center; }
    .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .title { font-size: 24px; font-weight: bold; color: #007BFF; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; text-align: center; }
    th, td { border: 1px solid #ddd; padding: 10px; }
    th { background-color: #007BFF; color: white; }
    .green { color: green; font-size: 20px; }
    .red { color: red; font-size: 20px; }
    .neutral { color: #777; font-size: 20px; }
    button { background-color: #007BFF; color: white; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; }
    button:hover { background-color: #0056b3; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">Python Proficiency Overview</h1>
    <p><strong>Student ID:</strong> <span id="student-id"></span></p>
    <p><strong>Name:</strong> <span id="student-name"></span></p>
    <table>
      <thead>
        <tr>
          <th>Concept Name</th>
          <th>Easy</th>
          <th>Medium</th>
          <th>Hard</th>
        </tr>
      </thead>
      <tbody id="report-body"></tbody>
    </table>
    <br>
    <button onclick="redirectToPractice()">View Recommended Questions</button>
  </div>
  <script>
    // Hardcoded student id for this file
    const studentId = "N24H01A0505";
    // Fetch proficiency data
    async function fetchProficiencyData() {
      try {
        const response = await fetch('https://manojpanchothi.github.io/proficiency_report/student_proficiency_data.json');
        if (!response.ok) throw new Error("HTTP error " + response.status);
        return await response.json();
      } catch (error) {
        console.error('Error fetching proficiency data:', error);
        alert("Error fetching student data. Please try again later.");
        return [];
      }
    }
    async function loadStudentData() {
      const proficiencyData = await fetchProficiencyData();
      if (!proficiencyData.length) {
        alert("No student data found.");
        return;
      }
      // Filter records by student id (niat_id)
      const studentRecords = proficiencyData.filter(s => s.niat_id === studentId);
      if (!studentRecords.length) {
        alert("Student not found.");
        return;
      }
      // Use first record for display
      const record = studentRecords[0];
      document.getElementById("student-name").innerText = record.student_name;
      document.getElementById("student-id").innerText = record.niat_id;
      
      const orderedTopics = [
        "IO_BASICS", "OPERATORS", "ARITHMETIC_OPERATORS", "ARITHMETIC_OPERATIONS",
        "CONDITIONAL_STATEMENTS_IF_ELSE", "LOOPS_FOR", "NESTED_LOOPS", "PATTERNS",
        "FUNCTIONS", "BUILT_IN_FUNCTIONS", "DATA_TYPE_STRING", "STRING_METHODS",
        "STRING_OPERATIONS", "STRING_MANIPULATION", "DATA_TYPE_LIST", "LISTS",
        "DATA_TYPE_SET", "DATA_TYPE_DICTIONARY"
      ];
      
      const proficiencyMap = {};
      studentRecords.forEach(record => {
        if (!proficiencyMap[record.sub_topic]) {
          proficiencyMap[record.sub_topic] = { easy: "-", medium: "-", hard: "-" };
        }
        // Assume percentage is a fraction (e.g., 0.5 means 50%)
        const rawPercentage = record.percentage_of_questions_solved;
        const percentageSolved = typeof rawPercentage === "number"
          ? rawPercentage
          : parseFloat(String(rawPercentage).replace('%', '')) || 0;
        const status = (percentageSolved * 100) >= 50 ? "✅" : "❌";
        if (record.difficulty === "EASY") proficiencyMap[record.sub_topic].easy = status;
        if (record.difficulty === "MEDIUM") proficiencyMap[record.sub_topic].medium = status;
        if (record.difficulty === "HARD") proficiencyMap[record.sub_topic].hard = status;
      });
      
      const reportBody = document.getElementById("report-body");
      orderedTopics.forEach(concept => {
        if (proficiencyMap[concept]) {
          const row = `<tr>
            <td>${concept}</td>
            <td class="${proficiencyMap[concept].easy === '-' ? 'neutral' : proficiencyMap[concept].easy === '✅' ? 'green' : 'red'}">${proficiencyMap[concept].easy}</td>
            <td class="${proficiencyMap[concept].medium === '-' ? 'neutral' : proficiencyMap[concept].medium === '✅' ? 'green' : 'red'}">${proficiencyMap[concept].medium}</td>
            <td class="${proficiencyMap[concept].hard === '-' ? 'neutral' : proficiencyMap[concept].hard === '✅' ? 'green' : 'red'}">${proficiencyMap[concept].hard}</td>
          </tr>`;
          reportBody.innerHTML += row;
        }
      });
    }
    // Redirect to practice page using the student id in the file name.
    function redirectToPractice() {
      window.location.href = "practice_questions-" + studentId + ".html";
    }
    loadStudentData();
  </script>
</body>
</html>